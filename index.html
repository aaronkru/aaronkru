<!DOCTYPE html>

<script>
  
  /* CONFIGURATION VARIABLES: */
  
  /* Printable Charts (false by default):
   * 
   * Setting this variable to "true" will enable a "static mode" for
   * all charts. Rather than being interactive, the line charts will
   * display static gridlines and the bar charts will display their actual
   * values above each bar. The graphs will still update if the drop-
   * down menu is changed to a different county.
   * 
   * You should enable this setting when saving the charts as SVG images
   * to be used in a printable county fact sheet. */
  var ENABLE_PRINTABLE_CHARTS = false;
  
</script>


<html>
  <head> 
    <meta charset="utf-8">
    <title>countySTATs - Master</title>
    <style>
      iframe {
        border: solid 1px #eee;
        border-bottom: solid 1px #ccc;
        width: 960px;
      }
      body {
        font-family: "Helvetica Neue", Helvetica, sans-serif;
        margin: 2em auto 4em auto;
        tab-size: 2;
        -webkit-text-size-adjust: none;
      }
      .column {
        max-width: 960px;
        position: relative;
        display: block;
        margin: 0 auto;
        padding: 0 10px;
      }
      h1 {
        font-size: 46px;
        font-weight: 500;
        letter-spacing: -1px;
        margin: 0.1em 0;
      }
      h1, h3, .fact, .desc{
        margin-left: 40px;
      }
      h2 {
        margin-left: 20px;
      }
      pre {
        border-left: solid 2px #ccc;
        padding-left: 18px;
        margin: 2em 0 2em -20px;
        max-width: 960px;
        overflow-x: auto;
      }
      p, ul {
        font-size: 14px;
      }


    </style>
  </head>
  
  <body>
    <h1>CountySTATs - Master Mockup</h1>
    <h3>Updated December 1, 2017</h3>
    
    <div class="column">
      <div style="float:left; width:50%; height:260px">
        <br><br><br><br><br>
        <h4 style="font-size: 20px"><b><u>County Stats:</u></b></h4>
        <p style="font-size: 14px">Use the <b>drop-down menu below</b> to dynamically switch between counties, or click on a county to the right to be taken to a <b>printable fact sheet</b> for that county.</p>
      </div>
      <div style="float:right; width:50%, height:260px">
        <img src="county-map.png" style="height:257px; width:480px">
      </div>
    </div>
    
    <div id="drop" align="center"></div>
    
    <div class="column">
      <div style="float:left; width:50%">
        <h2>Population</h2> 
        <div class="population">
          <iframe id="population" sandbox="allow-popups allow-scripts allow-forms allow-same-origin" src="/Population/Population.html" marginwidth="0" marginheight="0" style="height:260px; width:480px" scrolling="no"> </iframe>
        </div>
        
        <h2>Unemployment</h2>
        <div class="unemployment">
          <iframe class="frame" sandbox="allow-popups allow-scripts allow-forms allow-same-origin" src="/County Unemployment/Unemployment.html" marginwidth="0" marginheight="0" style="height:260px; width:480px" scrolling="no"></iframe>
        </div>
        
        <h2>Top 5 Employment Sectors</h2>
        <div class="employmentSectors">
        <iframe class="frame" sandbox="allow-popups allow-scripts allow-forms allow-same-origin" src="/Employment Sectors/topEmploymentSectors.html" marginwidth="0" marginheight="0" style="height:260px; width:480px" scrolling="no"></iframe>
        </div>
        
        <br>
        <h4 align="center">All data is the most recent available at time of publication, ranging from 2013 to 2015.</h4>
        <p style="text-align:center"><img align="center" src="okpolicyLogo.png"></p>
      </div>
      
      <div style="float:right; width:50%">
        <h2>Demographics</h2>
        <div class="demographics">
        <iframe class="frame" sandbox="allow-popups allow-scripts allow-forms allow-same-origin" src="/Demographics/Demographics.html" marginwidth="0" marginheight="0" style="height:260px; width:480px" scrolling="no"></iframe>
        </div>
        
        <h2>Educational Attainment</h2>
        <div class="educationalAttainment">
          <iframe class="frame" sandbox="allow-popups allow-scripts allow-forms allow-same-origin" src="/Educational Attainment/educationalAttainment.html" marginwidth="0" marginheight="0" style="height:260px; width:480px" scrolling="no"> </iframe>
        </div>
        
        <h2>More Stats</h2>
        <p class="desc">For all measures, a rank of 1st indicates the highest statistic and 77th indicates the lowest statistic among the 77 counties of Oklahoma (not best or worst).</p>
        <p style="text-align:center; font-weight:bold" class="countyname"></p>
        <ul>
          <!--style="color:#972421; font-size:18px"-->
          <p>Demographics</p>
          <li class="fact"><b>Number of voting-age citizens: </b></li>
          <li class="fact"><b>Percent aged under 18: </b></li>
          <li class="fact"><b>Percent aged 65 and up: </b></li>
          <p>Economy</p>
          <li class="fact"><b>Median household income: </b></li>
          <li class="fact"><b>Residents receiving food stamps: </b></li>
          <li class="fact"><b>Children living in poverty: </b></li>
          <li class="fact"><b>Median value of owner-occupied homes: </b></li>
          <p>Education</p>
          <li class="fact"><b>Average A-F school grade: </b></li>
          <li class="fact"><b>Students eligible for free/reduced lunch price: </b></li>
          <li class="fact"><b>Students enrolled in public school: </b></li>
          <p>Health</p>
          <li class="fact"><b>Overall health rank: </b></li>
          <li class="fact"><b>Residents with a disability: </b></li>
          <li class="fact"><b>Adults with obesity: </b></li>
          <li class="fact"><b>Percentage of uninsured residents: </b></li>
          <br>
          <div class="sheet"></div>
        </ul>
      </div>
      
    </div>
  </body>
  
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script>
  
    var counties = ["Adair County","Alfalfa County","Atoka County","Beaver County","Beckham County","Blaine County","Bryan County","Caddo County","Canadian County","Carter County","Cherokee County","Choctaw County","Cimarron County","Cleveland County","Coal County","Comanche County","Cotton County","Craig County","Creek County","Custer County","Delaware County","Dewey County","Ellis County","Garfield County","Garvin County","Grady County","Grant County","Greer County","Harmon County","Harper County","Haskell County","Hughes County","Jackson County","Jefferson County","Johnston County","Kay County","Kingfisher County","Kiowa County","Latimer County","Le Flore County","Lincoln County","Logan County","Love County","Major County","Marshall County","Mayes County","McClain County","McCurtain County","McIntosh County","Murray County","Muskogee County","Noble County","Nowata County","Okfuskee County","Oklahoma County","Okmulgee County","Osage County","Ottawa County","Pawnee County","Payne County","Pittsburg County","Pontotoc County","Pottawatomie County","Pushmataha County","Roger Mills County","Rogers County","Seminole County","Sequoyah County","Stephens County","Texas County","Tillman County","Tulsa County","Wagoner County","Washington County","Washita County","Woods County","Woodward County"]
    
    
    d3.csv("CountyMetrics_Master.csv", function(error, data) {
      if (error) throw error;
            
      var selection = "Adair County",
          mappedData = mapData(selection, data);
      
      d3.select(".countyname")
        .text(selection)
                
      var stat = d3.selectAll(".fact")
        .append("text")
        .attr("x", 10)
        .attr("y", 0)
        .text(function(d, i) {
          var valueAndRank = mappedData[i]["MetricValue"];
          if (i != 0 && i != 10) 
            valueAndRank += " (" + mappedData[i]["Rank"] + ")";
          return valueAndRank;
        });
      
      function mapData(selection, data) {
        var mapping = [];
        for (var i = 0; i < data.length; i++) {
          var metric = data[i].Metric;
          var metricvalue = data[i][selection];
          var rank = applySuffix(data[i+1][selection]);
          if (i == 19)
            metricvalue = applySuffix(metricvalue);
          
          var setup = {}
          setup["Metric"] = metric;
          setup["MetricValue"] = metricvalue;
          setup["Rank"] = rank;
          
          mapping.push(setup);
          
          if (i != 0 && i != 19)
            i++;
        }
        return mapping;
      }
      
      function applySuffix(str) {
        if (str[str.length - 1] == "1") {
            str += "st";
          } else if (str[str.length - 1] == "2") {
            str += "nd";
          } else if (str[str.length - 1] == "3") {
            str += "rd";
          } else str += "th";
        return str;
      }
      
    var link = d3.selectAll(".sheet")
      .append("a")
      .attr("href", "https://okpolicy.org/wp-content/uploads/Adair-2015.pdf?x43134")
      .attr("target", "_blank")
      .attr("style", "font-size:12px")
      .html("Get a printable version of this county's charts & stats...");
    
    var selector = d3.select('#drop')
            .append("select")
            .attr("id", "dropdown")
            .on("change.master", function(d){
              
              var selection = this.options[this.selectedIndex].value,
                  linkedSheet = "https://okpolicy.org/wp-content/uploads/" + selection.slice(0, -7) + "-2015.pdf?x43134";
              
              stat.data(mapData(selection, data));
              
              stat.transition()
                  .text(function(d, i) {
                    var valueAndRank = d.MetricValue
                    if (i !=0 && i != 10) 
                      valueAndRank += " (" + d.Rank + ")";
                    return valueAndRank;
                  });
    
              link.transition()
                  .attr("href", linkedSheet);
              
              d3.select(".countyname")
                .text(selection);
              
            });

    selector.selectAll("option")
          .data(counties)
          .enter().append("option")
          .attr("value", function(d){
            return d;
          })
          .text(function(d){
            return d;
          });
    })
  </script>
  
</html>
